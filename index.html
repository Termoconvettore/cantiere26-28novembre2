<script>
    document.addEventListener("DOMContentLoaded", async () => {
      
      const container = document.getElementById('container');

      const mindarThree = new window.MINDAR.IMAGE.MindARThree({
        container: container,
        imageTargetSrc: "./mindar-image-target.mind",
        // Nuove impostazioni per tracking piÃ¹ stabile e reattivo
        maxTrack: 2,         
        filterMinCF: 0.0001
      });

      const {renderer, scene, camera} = mindarThree;

      const video = document.querySelector("#video");
      
      await new Promise(resolve => {
        if (video.readyState >= 4) {
            resolve();
        } else {
            video.oncanplaythrough = resolve;
        }
      });
      
      const texture = new THREE.VideoTexture(video);

      const plane = new THREE.Mesh(
        new THREE.PlaneGeometry(1.4, 1), 
        new THREE.MeshBasicMaterial({map: texture})
      );
      
      // Sposta il piano virtuale leggermente indietro per evitare lo "stacco"
      plane.position.z = -0.01; 

      const anchor = mindarThree.addAnchor(0); 
      anchor.group.add(plane);

      anchor.onTargetFound = () => {
          video.play();
      };

      anchor.onTargetLost = () => {
          video.pause();
      };

      await mindarThree.start();

      const loop = () => {
        renderer.render(scene, camera);
        requestAnimationFrame(loop);
      };
      loop();
    });
  </script>
